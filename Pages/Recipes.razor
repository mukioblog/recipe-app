@page "/recipes"
@inject RecipeService RecipeService
@inject NavigationManager Navigation
@using RecipeApp.Models
@using RecipeApp.Services

<PageTitle>レシピ一覧</PageTitle>

<div style="padding: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1>レシピ一覧</h1>
        <button class="btn btn-primary" @onclick="CreateNew">+ 新しいレシピ</button>
    </div>

    @if (recipes == null)
    {
        <p>読み込み中...</p>
    }
    else if (!recipes.Any())
    {
        <p>まだレシピがありません。新しいレシピを追加しましょう!</p>
    }
    else
    {
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
            @foreach (var recipe in recipes)
            {
                <div class="card" style="cursor: pointer;" @onclick="() => ViewDetail(recipe.Id)">
                    @if (!string.IsNullOrEmpty(recipe.ImageBase64))
                    {
                        <img src="@recipe.ImageBase64" class="card-img-top" alt="@recipe.Title" style="height: 200px; object-fit: cover;">
                    }
                    else
                    {
                        <div style="height: 200px; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                            <span>画像なし</span>
                        </div>
                    }
                    <div class="card-body">
                        <h5 class="card-title">@recipe.Title</h5>
                        <small class="text-muted">@recipe.CreatedAt.ToString("yyyy/MM/dd")</small>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    private List<Recipe>? recipes;

    protected override async Task OnInitializedAsync()
    {
        recipes = await RecipeService.GetAllRecipesAsync();
    }

    private void CreateNew()
    {
        Navigation.NavigateTo("/recipe/new");
    }

    private void ViewDetail(Guid id)
    {
        Navigation.NavigateTo($"/recipe/{id}");
    }
}